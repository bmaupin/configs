---
# Ansible has a dconf module but it doesn't work in Ubuntu 16.04 because python-psutil is < 4.0
# For some reason this keeps getting set to 1 and it resets the indicator display to default
# http://askubuntu.com/a/858069/18665
# https://bugs.launchpad.net/ubuntu/+source/indicator-multiload/+bug/1740751
- name: Reset indicator-multiload indicator-expression-index
  shell: >
    dconf read /de/mh21/indicator-multiload/general/indicator-expression-index | grep '' &&
    dconf reset /de/mh21/indicator-multiload/general/indicator-expression-index || true
  register: result
  changed_when: result.stdout != ''
  when:
    - ansible_distribution == "Ubuntu"
    - ansible_distribution_version == "16.04"

- name: Install packages for Ubuntu <= 14.04
  apt:
    name:
      # Provides purge-old-kernels, used by Remove old kernels
      - bikeshed
      - icedtea-7-plugin
      - openjdk-7-jdk
    state: present
  become: yes
  when:
    - ansible_distribution == "Ubuntu"
    - ansible_distribution_version is version_compare('14.04', '<=')

- name: Remove old kernels
  command: purge-old-kernels -y
  become: yes
  register: result
  changed_when: result.stdout.find('No kernels are eligible for removal') == -1
  when:
    - ansible_distribution == "Ubuntu"
    - ansible_distribution_version is version_compare('14.04', '<=')
