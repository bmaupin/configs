---
- name: Configure firewall
  include: ufw.yml

- name: Run tasks for Ubuntu <= 14.04
  include: ubuntu-le-1404.yml
  when:
    - ansible_distribution == "Ubuntu"
    - ansible_distribution_version | version_compare('14.04', '<=')

- name: Run tasks for Ubuntu >= 16.04
  include: ubuntu-ge-1604.yml
  when:
    - ansible_distribution == "Ubuntu"
    - ansible_distribution_version | version_compare('16.04', '>=')

- name: Remove undesired packages
  apt:
    name: "{{ item }}"
    state: absent
    purge: yes
  with_items:
    - empathy
    - evolution
  become: yes

- name: Install desired packages
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - apt-file
    - deja-dup
    - indicator-multiload
    - language-pack-fr
    - libreoffice-calc
    - libreoffice-impress
    - libreoffice-writer
    - mpv
    - nmap
    - pidgin
    - pidgin-sipe
    - python3
    - remmina
    - shotwell
    - vim
    - vlc
  become: yes

- name: Install LibreOffice French support
  apt:
    name: "{{ item }}"
    state: present
  with_items:
    - hyphen-fr
    - libreoffice-l10n-fr
    - myspell-fr
    - mythes-fr
  become: yes

- name: Copy .gitconfig
  copy:
    src: .gitconfig
    dest: ~/.gitconfig
    backup: yes

- name: Copy .vimrc
  copy:
    src: .vimrc
    dest: ~/.vimrc
    backup: yes

- name: Create ~/.fonts directory
  file:
    path: ~/.fonts
    state: directory

# This is for Office 365/Word Online (https://askubuntu.com/a/983192/18665)
- name: Install Symbol font
  get_url:
    url: https://source.winehq.org/git/wine.git/blob/HEAD:/fonts/symbol.ttf
    dest: ~/.fonts/symbol.ttf
  notify: Rebuild font cache

# This is for Office 365/Word Online (https://askubuntu.com/a/983192/18665)
- name: Install Wingdings font
  get_url:
    url: https://source.winehq.org/git/wine.git/blob/HEAD:/fonts/wingding.ttf
    dest: ~/.fonts/wingding.ttf
  notify: Rebuild font cache

- name: Default to Python 3 for future-proofing
  lineinfile:
    path: ~/.bashrc
    line: 'alias python=python3'

- name: Apt autoremove
  apt:
    autoremove: yes
  become: yes
  register: result
  changed_when: result.stdout.find('0 to remove') == -1

- name: Update apt-file cache
  command: apt-file update
  become: yes
